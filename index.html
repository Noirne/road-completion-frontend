<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Road completion project - overview</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>

<div id='map'></div>

<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoieGl2ayIsImEiOiJaQXc3QUJFIn0.nLL2yBYQbAQfhMBC-FIyXg';
    var map = new mapboxgl.Map({
        container: 'map', // container id
        style: {
            "version": 8,
            "name": "Mapbox Streets",
            "sprite": "mapbox://sprites/mapbox/streets-v8",
            "glyphs": "mapbox://fonts/mapbox/{fontstack}/{range}.pbf",
            "sources": {
                "agiv": {
                    type: "raster",
                    tiles: [
                        "http://tile.informatievlaanderen.be/ws/raadpleegdiensten/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=omwrgbmrvl&STYLE=&FORMAT=image/png&tileMatrixSet=GoogleMapsVL&tileMatrix={z}&tileRow={y}&tileCol={x}"
                    ],
                    tileSize: 256
                }
            },
            "layers": [
                {
                    "id":"background",
                    "type":"background",
                    "paint":{
                        "background-color":"rgb(4,7,14)"
                    }
                },
                {
                    "id":"satellite",
                    "type":"raster",
                    "source":"agiv",
                    "source-layer":"mapbox_satellite_full"
                }
            ]
        },
        // style: 'mapbox://styles/mapbox/satellite-v9',
        // style: 'mapbox://styles/xivk/cjdd899nbbm7y2spdd9xq6xil', // stylesheet location
        center: [4.4629, 51.0671], // starting position [lng, lat]
        zoom: 9, // starting zoom
        hash: true
    });

    // Add zoom and rotation controls to the map.
    map.addControl(new mapboxgl.NavigationControl());

    map.on("load", function() {
        var layers = map.getStyle().layers;
        // Find the index of the first symbol layer in the map style
        var firstSymbolId;
        for (var i = 0; i < layers.length; i++) {
            if (layers[i].id.includes("road")) {
                firstSymbolId = layers[i].id;
                break;
            }
        }

        // replace road tiles with road tiles for this instance.
        map.addSource("buffers", {
            "type": "vector",
            "tiles": [
                "http://roads-tiles.osm.be/data/buffers/{z}/{x}/{y}.pbf"
            ],
            "maxzoom": 14
        });
        map.addSource("diffs", {
            "type": "vector",
            "tiles": [
                "http://roads-tiles.osm.be/data/diff/{z}/{x}/{y}.pbf"
            ],
            "maxzoom": 14
        });
        // map.addSource("refs", {
        //     "type": "vector",
        //     "tiles": [
        //         "http://roads-tiles.osm.be/data/refs/{z}/{x}/{y}.pbf"
        //     ],
        //     "maxzoom": 14
        // });

        map.addLayer({
            "id": "buffers",
            "source": "buffers",
            "source-layer": "buffers",
            "type": "fill",
            "paint": {
                "fill-color": "#FFFFFF",
                "fill-opacity": 0.2
            },
            "minzoom": 14
        }, firstSymbolId);

        map.addLayer({
            "id": "diffs",
            "source": "diffs",
            "source-layer": "diff",
            "type": "line",
            "paint": {
                "line-color": "#FFFF00",
                "line-width": 2
            }
        });
    });
</script>

</body>
</html>